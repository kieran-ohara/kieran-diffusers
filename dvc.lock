schema: '2.0'
stages:
  train:
    cmd: accelerate launch submodules/diffusers/examples/dreambooth/train_dreambooth.py
      --pretrained_model_name_or_path="CompVis/stable-diffusion-v1-4" --class_data_dir="src/train/data/class-images/cat"
      --class_prompt="cat" --num_class_images="200" --instance_data_dir="src/train/data/instances/kowilfred"
      --instance_prompt="kowilfred" --output_dir=src/train/model --with_prior_preservation
      --prior_loss_weight=1.0 --resolution=512 --train_batch_size=1 --gradient_accumulation_steps=1
      --learning_rate="3e-06" --lr_scheduler="constant" --lr_warmup_steps=0 --max_train_steps="2600"
      --gradient_checkpointing --mixed_precision=fp16 --use_8bit_adam && mv src/train/model/2600
      src/train/modelx
    deps:
    - path: src/train/data/class-images/cat
      md5: cb859150c35f6f7c1cd05c934fe8b9bb.dir
      size: 9059289
      nfiles: 200
    params:
      params.yaml:
        instance.prompt: kowilfred
        learning_rate: 3e-06
        pretrained_model: CompVis/stable-diffusion-v1-4
        training_steps: 2600
    outs:
    - path: src/train/modelx
      md5: a71acbbdd94f8dda440a4b975122dca8.dir
      size: 4266985331
      nfiles: 13
  infer:
    cmd: "src/infer/infer.py 8280 -p prompts -i \"kokieran man\"\nsrc/infer/infer.py\
      \ 8280 -p prompts2 -i \"kokieran man\"\nsrc/infer/infer.py 8280 -p tough-ones\
      \ -i \"kokieran man\"\nsrc/infer/infer.py 8280 -p tough-ones2 -i \"kokieran\
      \ man\"\n"
    deps:
    - path: src/train/model/8280
      md5: c38fbf74016a43bb54b9f8da76aaff39.dir
      size: 4266985332
      nfiles: 13
    params:
      params.yaml:
        infer.instance: kokieran man
    outs:
    - path: src/infer/output
      md5: 8cc2835ffdca81ba080e4429964e7f72.dir
      size: 45730610
      nfiles: 4
  evaluate:
    cmd: infer/infer.py 10
    deps:
    - path: data/model/10
      md5: bf6ecc76507ee962ce456e724e57a91d.dir
      size: 4276362916
      nfiles: 14
  infer@prompts:
    cmd: src/infer/infer.py 100 -p "prompts" -i "kokieran man"
    deps:
    - path: src/train/output
      md5: 2ce48574aaa9b25631efcceb21980f86.dir
      size: 4266985329
      nfiles: 13
    outs:
    - path: src/infer/output/prompts.png
      md5: cc5fb73e29e6f2b810761f12df680387
      size: 11030897
  infer@prompts2:
    cmd: src/infer/infer.py 100 -p "prompts2" -i "kokieran man"
    deps:
    - path: src/train/output
      md5: 2ce48574aaa9b25631efcceb21980f86.dir
      size: 4266985329
      nfiles: 13
    outs:
    - path: src/infer/output/prompts2.png
      md5: ce2d6c8165f9cc6bb1661fc7106e3664
      size: 11173551
  infer@tough-ones:
    cmd: src/infer/infer.py 100 -p "tough-ones" -i "kokieran man"
    deps:
    - path: src/train/output
      md5: 2ce48574aaa9b25631efcceb21980f86.dir
      size: 4266985329
      nfiles: 13
    outs:
    - path: src/infer/output/tough-ones.png
      md5: d9b15545bd1d7153d3dc7dfa3e8c4b24
      size: 13285830
  infer@tough-ones2:
    cmd: src/infer/infer.py 100 -p "tough-ones2" -i "kokieran man"
    deps:
    - path: src/train/output
      md5: 2ce48574aaa9b25631efcceb21980f86.dir
      size: 4266985329
      nfiles: 13
    outs:
    - path: src/infer/output/tough-ones2.png
      md5: e33690aeb9f2bdb976a7d444ec92fa34
      size: 12830656
  class_images:
    cmd: accelerate launch submodules/diffusers/examples/dreambooth/train_dreambooth.py
      --pretrained_model_name_or_path="CompVis/stable-diffusion-v1-4" --class_data_dir="src/train/data/class-images/cat"
      --class_prompt="cat" --num_class_images="200" --instance_data_dir="src/train/data/instances/dummy"
      --instance_prompt="kodummy" --output_dir=src/train/model --with_prior_preservation
      --prior_loss_weight=1.0 --resolution=512 --train_batch_size=1 --gradient_accumulation_steps=1
      --learning_rate="5e-06" --lr_scheduler="constant" --lr_warmup_steps=0 --max_train_steps="1"
      --gradient_checkpointing --mixed_precision=fp16 --use_8bit_adam && rm -rf src/train/model/2600
    params:
      params.yaml:
        class.count: 200
        class.prompt: cat
        pretrained_model: CompVis/stable-diffusion-v1-4
    outs:
    - path: src/train/data/class-images/cat
      md5: cb859150c35f6f7c1cd05c934fe8b9bb.dir
      size: 9059289
      nfiles: 200
  infer@cat-prompts:
    cmd: src/infer/infer.py -p "cat-prompts" -i "kowilfred cat"
    deps:
    - path: src/train/modelx
      md5: a71acbbdd94f8dda440a4b975122dca8.dir
      size: 4266985331
      nfiles: 13
    outs:
    - path: src/infer/output/cat-prompts.png
      md5: 5c4ed82920ae1b957a34640ba6fa26d1
      size: 6449274
  infer@cat-prompts2:
    cmd: src/infer/infer.py -p "cat-prompts2" -i "kowilfred cat"
    deps:
    - path: src/train/modelx
      md5: a71acbbdd94f8dda440a4b975122dca8.dir
      size: 4266985331
      nfiles: 13
    outs:
    - path: src/infer/output/cat-prompts2.png
      md5: b3b327394929b3a3f54ef325ec607916
      size: 6334989
  infer@cat-prompts3:
    cmd: src/infer/infer.py -p "cat-prompts3" -i "kowilfred cat"
    deps:
    - path: src/train/modelx
      md5: a71acbbdd94f8dda440a4b975122dca8.dir
      size: 4266985331
      nfiles: 13
    outs:
    - path: src/infer/output/cat-prompts3.png
      md5: 572ea033bedd5b274062b51a877b80e8
      size: 6200198
